<html>
	<head>
		<title>cube</title>
	</head>
	<body>
		<canvas width="250" height="400" id="mCanvas"></canvas>
		<script>
			var hasCube;
			var cube;
			var cubes = [
						 [[1, 0, 0],
						  [1, 1, 1]],
						 [[1, 1],
						  [1, 1]],
						 [[1, 1, 1, 1]],
						 [[0, 1, 0],
						  [1, 1, 1]] 
						  ];
			var map;
			var cubeX, cubeY;
			var color = ["rgba(10,10,10,0.2)", "rgba(50,50,50,1)", "rgba(90,90,90,1)"];
			var ctx;
			function drawRect(i, j, type=0){
				ctx.fillStyle = color[type];
				ctx.fillRect(i*25+3, j*25+3, 19, 19);
			}
			function init(){
				hasCube = false;
				ctx = document.getElementById("mCanvas").getContext('2d');
				map = new Array();
				for(var i=0; i<10; i++){
					var column = new Array();
					for(var j=0; j<16; j++)
						column.push(0);
					map.push(column);
				}
				map[1][1] = 2;
			}
			function createCube(){
				hasCube = true;
				cube = cubes[parseInt(Math.random()*4)];
				cubeY = 0;
				cubeX = 3;
			}
			function drop(){
				for(var i=0; i<15; i++)
					for(var j=0;j<10;j++)
						if(map[j][i]==2) map[j][i]=0;
				for(var i=0; i<cube.length; i++){
					for(var j=0; j<cube[i].length; j++){
						if(cube[i][j] == 1&&map[cubeX+j][cubeY+1-cube.length+i]==1){
							hasCube = false;
							for(var i=0; i<15; i++)
								for(var j=0;j<10;j++)
									if(map[j][i]==2) map[j][i]=1;
						}
					}	
				}
				if(hasCube)
					for(var i=0; i<cube.length; i++)
						for(var j=0; j<cube[i].length; j++)
							map[cubeX+j][cubeY-cube.length+i] = 2;
				cubeY++;
			}
			function disLine(){
				for(var i=15; i>0; i--){
					var all=0;
					for(var j=0;j<10;j++){
						if(map[j][i]==0){
							all=1;
							break;
						}
					}
					if(all==0){
						for(var g=i; g>1; g++)
							for(var c=0; c<10; c++)
								map[c][g] = map[c][g+1];
						i++;
					}
				}
			}
			function logic(){
				if(!hasCube){
					createCube();
				}
				drop();
				disLine();
			}
			function onDraw(){
				for(var x=0; x<10; x++)
					for(var y=0; y<16; y++)
						drawRect(x, y, map[x][y]);
			}
			function animation(){
				ctx.clearRect(0, 0, 250, 400);
				logic();
				onDraw();
				setTimeout(animation, 500);
			}
			init();
			animation();
		</script>	
	</body>
	
</html>
